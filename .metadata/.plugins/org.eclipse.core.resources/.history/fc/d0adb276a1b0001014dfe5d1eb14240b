package com.smhrd.controller;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import com.smhrd.frontcontroller.Command;
import com.smhrd.model.MemberDAO;
import com.smhrd.model.MemberVO;

public class UpdateService implements Command {

    @Override
    public String execute(HttpServletRequest request, HttpServletResponse response) {

        // 1. 폼 데이터 수집
        String pw = request.getParameter("pw");
        String tel = request.getParameter("tel");
        String address = request.getParameter("address");

        // 2. 로그인한 사용자 이메일 세션에서 가져오기
        HttpSession session = request.getSession();
        MemberVO loginMember = (MemberVO) session.getAttribute("result");
        String email = loginMember.getEmail();

        // 3. DTO로 묶기
        MemberVO dto = new MemberVO();
        dto.setEmail(email);
        dto.setPw(pw);
        dto.setTel(tel);
        dto.setAddress(address);

        // 4. DAO로 전달해서 DB 수정
        MemberDAO dao = new MemberDAO();
        int cnt = dao.updateMember(dto);

        // 5. 성공 여부 확인
        if (cnt > 0) {
            System.out.println("회원정보 수정 성공!");
            session.setAttribute("result", dto); // 세션 정보 갱신
        } else {
            System.out.println("회원정보 수정 실패...");
        }

        // 6. 페이지 이동
        return "update.jsp";
    }
}