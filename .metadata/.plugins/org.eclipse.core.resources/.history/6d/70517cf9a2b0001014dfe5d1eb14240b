package com.smhrd.controller;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import com.smhrd.frontcontroller.Command;
import com.smhrd.model.MemberDAO;
import com.smhrd.model.MemberVO;

public class UpdateService implements Command {

    @Override
    public String execute(HttpServletRequest request, HttpServletResponse response) {

        // 폼에서 전달된 데이터(pw, tel, address) 수집
		String pw = request.getParameter("pw");
		String tel = request.getParameter("tel");
		String address = request.getParameter("address");
        // 세션에서 로그인한 회원 정보 가져오기 (email 꺼내기)
        HttpSession session = request.getSession();
        MemberVO loginMember = (MemberVO) session.getAttribute("result");
        String email = loginMember.getEmail();
        // 새 비밀번호, 전화번호, 주소, 이메일을 vo에 저장
        MemberVO vo = new MemberVO();
        vo.setEmail(email);
        vo.setPw(pw);
        vo.setTel(tel);
        vo.setAddress(address);
        // DAO 객체 생성 후 updateMember(dto) 실행
        MemberDAO dao = new MemberDAO();
        int cnt = dao.updateMember(vo); 
        if (cnt > 0) {
            // 세션의 로그인 객체 최신 데이터로 교체
            session.setAttribute("result", vo);
            request.setAttribute("msg", "회원정보가 수정되었습니다.");
        } else {
            request.setAttribute("msg", "수정에 실패했습니다. 다시 시도해주세요.");
        }

        // 7) 이동할 페이지
        return "Update.do"; // 
    }

}